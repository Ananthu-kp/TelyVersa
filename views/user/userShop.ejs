<%- include("../partials/header") %>

    <section class="mt-50 mb-50">
        <div class="container">
            <div class="row flex-row-reverse">
                <div class="col-lg-9">

                    <div class="search-style-1 pl-1300">
                        <form action="/search">
                            <div class="input-group">
                                <input type="text" id="filterItem" name="search" class="form-control"
                                    placeholder="Search...">
                            </div>
                        </form>
                    </div>



                    <div class="shop-product-fillter">
                        <div class="totall-product">

                        </div>
                        <div class="sort-by-product-area">
                            <div class="sort-by-product-wrap">
                                <div class="sort-by">
                                    <span><i class="fi-rs-apps-sort"></i>Sort by:</span>
                                </div>
                                <div class="sort-by-dropdown-wrap">
                                    <select id="sortByDropdown" onchange="handleSortChange(this.value)">
                                        <option value="featured" selected>Featured</option>
                                        <option value="lowToHigh">Price: Low to High</option>
                                        <option value="highToLow">Price: High to Low</option>
                                        <option value="A-Z">A-Z</option>
                                        <option value="Z-A">Z-A</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row product-grid-3">
                        <% for (let i=0; i < product.length; i++) { %>
                            <div class="col-lg-4 col-md-4 col-12 col-sm-6">
                                <div class="product-cart-wrap mb-30">
                                    <div class="product-img-action-wrap">
                                        <div class="product-img product-img-zoom">
                                            <a href="/productDetails?id=<%=product[i].id %>">
                                                <img class="default-img"
                                                    src="/uploads/products/<%=product[i].productImage[0]%>" alt="">
                                            </a>
                                        </div>
                                        <div class="product-action-1">

                                            <a aria-label="Add To Wishlist" class="action-btn hover-up"
                                                href="shop-wishlist.html"><i class="fi-rs-heart"></i></a>

                                        </div>
                                        <div class="product-badges product-badges-position product-badges-mrg">
                                            <span class="hot">Hot</span>
                                        </div>
                                    </div>
                                    <div class="product-content-wrap">
                                        <div class="product-category">
                                            <a href="shop-grid-right.html"><%-product[i].category%></a>
                                        </div>
                                        <h2><a href="products-product-right.html"><%-product[i].productName%></a></h2>
                                        <!-- <div class="rating-result" title="90%">
                                            <span>
                                                <span>90%</span>
                                            </span>
                                        </div> -->
                                        <div class="product-price">
                                            <span>₹<%-product[i].salePrice.toLocaleString('en-IN')%> </span>
                                            <span
                                                class="old-price">₹<%-product[i].regularPrice.toLocaleString('en-IN')%></span>
                                        </div>
                                        <div class="product-action-1 show">
                                            <a aria-label="Add To Cart" class="action-btn hover-up"
                                                href="shop-cart.html"><i class="fi-rs-shopping-bag-add"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                    </div>

                </div>
                <div class="col-lg-3 primary-sidebar sticky-sidebar">
                    <div class="widget-category mb-30">
                        <h5 class="section-title style-1 mb-30 wow fadeIn animated">Category</h5>

                        <ul class="categories">
                            <% for(let i=0; i < category.length; i++) { %>
                                <li><a href="/filter?category=<%= category[i]._id %>">
                                        <%= category[i].name %>
                                    </a></a></li>
                                <% } %>
                        </ul>

                    </div>
                    <!-- Fillter By Price -->
                    <!-- <div class="sidebar-widget price_range range mb-30">
                            <div class="widget-header position-relative mb-20 pb-10">
                                <h5 class="widget-title mb-10">Fill by price</h5>
                                <div class="bt-1 border-color-1"></div>
                            </div> -->
                    <!-- <div class="price-filter">
                                <div class="price-filter-inner">
                                    <div id="slider-range"></div>
                                    <div class="price_slider_amount">
                                        <div class="label-input">
                                            <span>Range:</span><input type="text" id="amount" name="price" placeholder="Add Your Price" />
                                        </div>
                                    </div>
                                </div>
                            </div> -->
                    <!-- <div class="list-group">
                                <div class="list-group-item mb-10 mt-10">
                                    <label class="fw-900">Size</label>
                                    <div class="custome-checkbox">
                                        <input class="form-check-input" type="checkbox" name="checkbox" id="exampleCheckbox1" value="">
                                        <label class="form-check-label" for="exampleCheckbox1"><span>Red (56)</span></label>
                                        <br>
                                        <input class="form-check-input" type="checkbox" name="checkbox" id="exampleCheckbox2" value="">
                                        <label class="form-check-label" for="exampleCheckbox2"><span>Green (78)</span></label>
                                        <br>
                                        <input class="form-check-input" type="checkbox" name="checkbox" id="exampleCheckbox3" value="">
                                        <label class="form-check-label" for="exampleCheckbox3"><span>Blue (54)</span></label>
                                    </div>
                                </div>
                            </div> -->
                    <!-- <a href="shop-grid-right.html" class="btn btn-sm btn-default"><i class="fi-rs-filter mr-5"></i> Fillter</a>
                        </div> -->

                </div>
            </div>
        </div>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const filterItem = document.getElementById("filterItem");

            // Add event listener for input change
            filterItem.addEventListener("input", function () {
                const searchQuery = filterItem.value.trim();

                // Call the search function when input changes
                searchProducts(searchQuery);
            });
        });

        async function searchProducts(searchQuery) {
            try {
                const response = await fetch(`/search?search=${encodeURIComponent(searchQuery)}`);
                const searchData = await response.json();

                // Update the product grid with search results
                updateProductGrid(searchData);
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function updateProductGrid(searchData) {
            // Implement logic to update the product grid with search results
            console.log(searchData);
            // Example: You can update the HTML content dynamically
            const productGrid = document.querySelector('.product-grid-3');
            productGrid.innerHTML = ''; // Clear existing content

            searchData.forEach(product => {
                const productHTML = `
                        <div class="col-lg-4 col-md-4 col-12 col-sm-6">
                            <!-- Render product details here using product object -->
                        </div>
                    `;
                productGrid.innerHTML += productHTML;
            });
        }


        function handleSortChange(selectedOption) {

            let option = selectedOption;
            
            $.ajax({
                url: "/sortProducts",
                method: "POST",
                data: {
                    option: option,
                   
                },
                success: (response) => {
                    if (response.status === true) {
                        // Assuming the server returns an array of products in response.data
                        const sortedProducts = response.data;
                        console.log(sortedProducts);
                        // Clear existing product grid content
                        $(".product-grid-3").empty();
                        

                        // Render each product in the container
                        sortedProducts.currentProduct.forEach((product) => {
                            const productDiv = $("<div class='col-lg-4 col-md-4 col-12 col-sm-6'>" +
                                "<div class='product-cart-wrap mb-30'>" +
                                "<div class='product-img-action-wrap'>" +
                                "<div class='product-img product-img-zoom'>" +
                                "<a href='/productDetails?id=" + product._id + "'>" +
                                "<img class='default-img' src='/uploads/products/" + product.productImage[0] + "' alt=''>" +
                                "</a>" +
                                "</div>" +
                                "<div class='product-action-1'>" +
                                "<a aria-label='Add To Wishlist' class='action-btn hover-up' href='javascript:void(0);' onclick='addToWishlist(\"" + product._id + "\")'>" +
                                "<i class='fi-rs-heart'></i>" +
                                "</a>" +
                                "</div>" +
                                "<div class='product-badges product-badges-position product-badges-mrg'>" +
                                "<span class='hot'>Hot</span>" +
                                "</div>" +
                                "</div>" +
                                "<div class='product-content-wrap'>" +
                                "<div class='product-category'>" +
                                "<h2><a href='shop-product-right.html'>" + product.productName + "</a></h2>" +
                                "<div class='product-price'>" +
                                "<span>₹" + product.salePrice.toLocaleString('en-IN') + "</span>" +
                                "<span class='old-price'>₹" + product.regularPrice.toLocaleString('en-IN') + "</span>" +
                                "</div>" +
                                "<div class='product-action-1 show'>" +
                                "<a aria-label='Add To Cart' class='action-btn hover-up' href='shop-cart.html'>" +
                                "<i class='fi-rs-shopping-bag-add'></i>" +
                                "</a>" +
                                "</div>" +
                                "</div>" +
                                "</div>" +
                                "</div>");

                            // Append the productDiv to the product grid
                            $(".product-grid-3").append(productDiv);
                           
                        });
                    } else {
                        console.error("Error in sorting products:", response);
                    }
                }
            });
        }

    </script>

    <%- include("../partials/footer") %>